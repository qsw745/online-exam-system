<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§’è‰²æƒé™æœ€ç»ˆæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-item { margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .result { margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 3px; white-space: pre-wrap; font-family: monospace; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ è§’è‰²æƒé™åŠŸèƒ½æœ€ç»ˆæµ‹è¯•</h1>
        
        <div class="test-item info">
            <h3>æµ‹è¯•è¯´æ˜</h3>
            <p>æ­¤é¡µé¢ç”¨äºéªŒè¯è§’è‰²ç®¡ç†é¡µé¢çš„èœå•æƒé™è®¾ç½®åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
            <p>é¢„æœŸç»“æœï¼šèœå•æ•°æ®èƒ½å¤Ÿæ­£ç¡®åŠ è½½å¹¶åœ¨æƒé™è®¾ç½®å¼¹çª—ä¸­æ˜¾ç¤ºä¸ºæ ‘å½¢ç»“æ„ã€‚</p>
        </div>
        
        <div class="test-item">
            <h3>æ­¥éª¤1: æµ‹è¯•èœå•API</h3>
            <button class="button" onclick="testMenuAPI()">ğŸ” æµ‹è¯•èœå•API</button>
            <div id="apiResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>æ­¥éª¤2: æ¨¡æ‹Ÿå‰ç«¯å¤„ç†é€»è¾‘</h3>
            <button class="button" onclick="simulateProcessing()">âš™ï¸ æ¨¡æ‹Ÿæ•°æ®å¤„ç†</button>
            <div id="processResult" class="result"></div>
        </div>
        
        <div class="test-item">
            <h3>æ­¥éª¤3: è®¿é—®è§’è‰²ç®¡ç†é¡µé¢</h3>
            <button class="button" onclick="openRolePage()">ğŸš€ æ‰“å¼€è§’è‰²ç®¡ç†é¡µé¢</button>
            <p style="margin-top: 10px; font-size: 14px; color: #666;">ç‚¹å‡»åè¯·ï¼š<br>1. ç‚¹å‡»ä»»æ„è§’è‰²çš„"æƒé™è®¾ç½®"æŒ‰é’®<br>2. æŸ¥çœ‹èœå•æƒé™éƒ¨åˆ†æ˜¯å¦æ˜¾ç¤ºèœå•æ ‘<br>3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„è°ƒè¯•ä¿¡æ¯</p>
        </div>
        
        <div class="test-item">
            <h3>æ­¥éª¤4: æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—</h3>
            <button class="button" onclick="checkConsole()">ğŸ“‹ è¾“å‡ºè°ƒè¯•ä¿¡æ¯</button>
            <p style="margin-top: 10px; font-size: 14px; color: #666;">è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</p>
        </div>
    </div>

    <script>
        let testResults = {
            apiTest: null,
            processTest: null
        };
        
        async function testMenuAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•èœå•API...';
            
            try {
                const response = await fetch('/api/menu/menus', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('APIæµ‹è¯• - å“åº”çŠ¶æ€:', response.status);
                const data = await response.json();
                console.log('APIæµ‹è¯• - å“åº”æ•°æ®:', data);
                
                if (response.ok) {
                    testResults.apiTest = { success: true, data };
                    resultDiv.textContent = `âœ… APIæµ‹è¯•æˆåŠŸ\nçŠ¶æ€ç : ${response.status}\næ•°æ®ç±»å‹: ${Array.isArray(data) ? 'æ•°ç»„' : 'å¯¹è±¡'}\nèœå•æ•°é‡: ${Array.isArray(data) ? data.length : (data.data ? data.data.length : 'æœªçŸ¥')}\n\nå“åº”é¢„è§ˆ:\n${JSON.stringify(data, null, 2).substring(0, 500)}...`;
                } else {
                    testResults.apiTest = { success: false, error: data };
                    resultDiv.textContent = `âŒ APIæµ‹è¯•å¤±è´¥\nçŠ¶æ€ç : ${response.status}\né”™è¯¯ä¿¡æ¯: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                console.error('APIæµ‹è¯•é”™è¯¯:', error);
                testResults.apiTest = { success: false, error: error.message };
                resultDiv.textContent = `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`;
            }
        }
        
        function simulateProcessing() {
            const resultDiv = document.getElementById('processResult');
            
            if (!testResults.apiTest || !testResults.apiTest.success) {
                resultDiv.textContent = 'âš ï¸ è¯·å…ˆæ‰§è¡Œæ­¥éª¤1çš„APIæµ‹è¯•';
                return;
            }
            
            try {
                const responseData = testResults.apiTest.data;
                let menuData = [];
                
                // æ¨¡æ‹Ÿä¿®å¤åçš„å¤„ç†é€»è¾‘
                if (responseData) {
                    if (Array.isArray(responseData)) {
                        menuData = responseData;
                        console.log('æ¨¡æ‹Ÿå¤„ç† - æ£€æµ‹åˆ°ç›´æ¥æ•°ç»„æ ¼å¼ï¼Œèœå•æ•°é‡:', menuData.length);
                    } else if (responseData.data && Array.isArray(responseData.data)) {
                        menuData = responseData.data;
                        console.log('æ¨¡æ‹Ÿå¤„ç† - æ£€æµ‹åˆ°æ ‡å‡†æ ¼å¼ï¼Œèœå•æ•°é‡:', menuData.length);
                    } else if (responseData.success && responseData.data) {
                        menuData = responseData.data;
                        console.log('æ¨¡æ‹Ÿå¤„ç† - æ£€æµ‹åˆ°successæ ¼å¼ï¼Œèœå•æ•°é‡:', menuData.length);
                    }
                }
                
                if (menuData.length > 0) {
                    testResults.processTest = { success: true, menuData };
                    resultDiv.textContent = `âœ… æ•°æ®å¤„ç†æˆåŠŸ\nèœå•æ•°é‡: ${menuData.length}\nç¬¬ä¸€ä¸ªèœå•: ${menuData[0]?.title || 'æ— æ ‡é¢˜'}\næœ€åä¸€ä¸ªèœå•: ${menuData[menuData.length-1]?.title || 'æ— æ ‡é¢˜'}\n\nèœå•åˆ—è¡¨é¢„è§ˆ:\n${menuData.slice(0, 5).map(m => `- ${m.title} (ID: ${m.id})`).join('\n')}${menuData.length > 5 ? '\n...' : ''}`;
                } else {
                    testResults.processTest = { success: false, error: 'æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆèœå•æ•°æ®' };
                    resultDiv.textContent = `âŒ æ•°æ®å¤„ç†å¤±è´¥\nåŸå› : æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„èœå•æ•°æ®\nå“åº”æ ¼å¼: ${JSON.stringify(responseData, null, 2)}`;
                }
            } catch (error) {
                console.error('æ•°æ®å¤„ç†é”™è¯¯:', error);
                testResults.processTest = { success: false, error: error.message };
                resultDiv.textContent = `âŒ å¤„ç†é”™è¯¯: ${error.message}`;
            }
        }
        
        function openRolePage() {
            window.open('/admin/roles', '_blank');
        }
        
        function checkConsole() {
            console.log('=== è§’è‰²æƒé™æµ‹è¯•ç»“æœæ±‡æ€» ===');
            console.log('APIæµ‹è¯•ç»“æœ:', testResults.apiTest);
            console.log('æ•°æ®å¤„ç†æµ‹è¯•ç»“æœ:', testResults.processTest);
            console.log('å½“å‰æ—¶é—´:', new Date().toLocaleString());
            console.log('æµ‹è¯•é¡µé¢URL:', window.location.href);
            
            alert('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æŸ¥çœ‹å¼€å‘è€…å·¥å…·çš„Consoleæ ‡ç­¾é¡µ');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡ŒAPIæµ‹è¯•
        window.onload = function() {
            console.log('è§’è‰²æƒé™æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(() => {
                testMenuAPI();
            }, 500);
        };
    </script>
</body>
</html>