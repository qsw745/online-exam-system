:80 {
    encode zstd gzip

    @api path /api*, /auth*, /uploads*
    reverse_proxy @api backend:3000

    # 先尝试代理到 web (nginx)，让它返回静态文件
    handle {
        reverse_proxy web:80
    }

    # 如果上面返回 404（例如前端路由），再回退到 /index.html
    handle_errors {
        @frontend404 expression {http.error.status_code} == 404
        rewrite @frontend404 /index.html
        reverse_proxy web:80
    }
}
